function cms_tpv_mouseover(e){var t=jQuery(this),s=t.closest("li");return cms_tpv_mouseover_li(e,s.get(0)),!0}function cms_tpv_tree_loaded(e){var t=jQuery(e.target),s=cms_tpv_get_page_actions_div_doit(e.target);s.hide(),t.find("li.has-visible-actions").removeClass("has-visible-actions"),t.find("a.hover").removeClass("hover"),t.find("div.cms_tpv_page_actions").removeClass("cms_tpv_page_actions_visible"),t.find("div.cms_tpv_page_actions_visible").removeClass("cms_tpv_page_actions_visible"),jQuery(t).on("mouseenter","a",function(e){cms_tree_page_view.log("mouseenter container");var _=t.data("cmstpv_global_link_timer");if(_&&(cms_tree_page_view.log("clear global timer"),clearTimeout(_)),cms_tree_page_view.log("add timer for mousover on link"),!s.is(":visible")){var a=setTimeout(function(){cms_tpv_mouseover_li(e)},500,e);t.data("cmstpv_global_link_timer",a)}}),jQuery(t).on("mousedown","a",function(e){cms_tree_page_view.log("mousedown a");var t=jQuery(e.target),s=t.closest("div.cms_tpv_container"),_=s.closest("div.cms_tpv_wrapper");s.find("li.has-visible-actions").removeClass("has-visible-actions"),s.find("a.hover").removeClass("hover"),_.find("div.cms_tpv_page_actions").removeClass("cms_tpv_page_actions_visible")})}function cms_tpv_get_post_type(e){return jQuery(e).closest("div.cms_tpv_wrapper").find("[name=cms_tpv_meta_post_type]").val()}function cms_tpv_get_wpml_selected_lang(e){return jQuery(e).closest("div.cms_tpv_wrapper").find("[name=cms_tpv_meta_wpml_language]").val()}function cms_tpv_get_page_actions_div(e){return jQuery(e).closest("div.cms_tpv_wrapper").find("div.cms_tpv_page_actions")}function cms_tpv_get_page_actions_div_doit(e){return jQuery(e).closest("div.cms_tpv_wrapper").find("div.cms_tpv_action_add_doit")}function cms_tpv_get_wrapper(e){var t=jQuery(e).closest("div.cms_tpv_wrapper");return t}function cms_tpv_is_dragging(){var e=jQuery("#vakata-dragged");return e.is(":visible")}function cms_tpv_mouseover_li(e){var t=jQuery(e.target),s=t.closest("li"),_=cms_tpv_get_page_actions_div(s),a=(cms_tpv_get_page_actions_div_doit(s),s.closest("div.cms_tpv_container"));if(cms_tpv_is_dragging()===!1){var i=_.is(":visible");if(i=!1);else{_.data("post_status",s.data("post_status")),a.find("li.has-visible-actions").removeClass("has-visible-actions"),a.find("a.hover").removeClass("hover"),s.addClass("has-visible-actions"),a.addClass("has-visible-actions"),s.find("a:first").addClass("hover"),$view=_.find(".cms_tpv_action_view");var n=s.data("permalink");$view.attr("href",n),$edit=_.find(".cms_tpv_action_edit");var r=s.data("editlink");$edit.attr("href",r),$edit.removeClass("hidden"),_.find(".cms_tpv_page_actions_modified_time").text(s.data("modified_time")),_.find(".cms_tpv_page_actions_modified_by").text(s.data("modified_author")),_.find(".cms_tpv_page_actions_page_id").text(s.data("post_id")),_.find(".cms_tpv_page_actions_columns").html(unescape(s.data("columns"))),_.find(".cms_tpv_page_actions_headline").html(s.data("post_title")),_.data("post_id",s.data("post_id")),_.find(".cms_tpv_action_add_page_inside, .cms_tpv_action_add_page_inside").removeClass("hidden");var c=!0;"draft"===s.data("post_status")&&(c=!1);var o=s.find("a"),d=(o.outerWidth(!0),_.offset()),p=e.pageX+35;p=o.offset().left+o.width()+20,d.left=p,d.top=o.offset().top-30,_.offset(d);var v=_.offset().top+_.height()-(jQuery(window).height()+jQuery(window).scrollTop());v>0?(d.top=o.offset().top-_.height()+15,_.offset(d),_.addClass("cms_tpv_page_actions_visible_from_bottom")):_.removeClass("cms_tpv_page_actions_visible_from_bottom"),_.addClass("cms_tpv_page_actions_visible");{_.find(".cms_tpv_action_add_and_edit_page")}"0"===s.data("user_can_edit_page")&&$edit.addClass("hidden"),$cms_tpv_add_position=_.find(".cms_tpv_add_position"),$cms_tpv_add_position.removeClass("hidden"),$cms_tpv_action_add_page_after=_.find(".cms_tpv_action_add_page_after"),$cms_tpv_action_add_page_after.removeClass("hidden"),"0"===s.data("user_can_add_page_after")&&($cms_tpv_action_add_page_after.addClass("hidden"),$cms_tpv_add_position.addClass("hidden")),$cms_tpv_action_add_page_inside=_.find(".cms_tpv_action_add_page_inside"),$cms_tpv_action_add_page_inside.removeClass("hidden"),"0"===s.data("user_can_add_page_inside")&&($cms_tpv_action_add_page_inside.addClass("hidden"),$cms_tpv_add_position.addClass("hidden"))}}}function cms_tpv_bind_clean_node(){cms_tpv_tree.bind("move_node.jstree",function(e,t){var s,_,a=t.rslt.o,i=(t.rslt.np,t.rslt.p),n=t.rslt.r,r=t.rslt.or,c=cms_tpv_get_wpml_selected_lang(a);"before"==i?(s=jQuery(a).attr("id"),_=jQuery(r).attr("id")):"after"==i?(s=jQuery(a).attr("id"),_=jQuery(n).attr("id")):"inside"==i&&(s=jQuery(a).attr("id"),_=jQuery(n).attr("id")),jQuery.post(ajaxurl,{action:"cms_tpv_move_page",node_id:s,ref_node_id:_,type:i,icl_post_language:c},function(){})}),cms_tpv_tree.bind("clean_node.jstree",function(e,t){var s=t.rslt.obj;s&&-1!=s&&s.each(function(e,t){var s=jQuery(t),_=s.find("a:first");if(!s.data("done_cms_tpv_clean_node")){s.data("done_cms_tpv_clean_node",!0);var a=s.data("childCount");a>0&&_.append("<span title='"+a+" "+cmstpv_l10n.child_pages+"' class='child_count'>("+a+")</span>");var i=s.data("rel");"password"==i&&_.find("ins").after("<span class='post_protected' title='"+cmstpv_l10n.Password_protected_page+"'>&nbsp;</span>");var n=s.data("post_status"),r="";(r=cmstpv_l10n["Status_"+n+"_ucase"])||(r=n),"publish"!=n&&_.find("ins").first().after("<span class='post_type post_type_"+n+"'>"+r+"</span>")}})})}function cms_tpv_hide_action_div(){}function cms_tpv_get_current_view(e){return $wrapper=cms_tpv_get_wrapper(e),$wrapper.find(".cms_tvp_view_all").hasClass("current")?"all":$wrapper.find(".cms_tvp_view_public").hasClass("current")?"public":!1}function cms_tvp_set_view(e,t){var s=jQuery(t).closest(".cms_tpv_wrapper"),_=cms_tpv_get_page_actions_div(t);cms_tpv_message.hide(),s.append(_),s.find(".cms_tvp_view_all, .cms_tvp_view_public, .cms_tvp_view_trash").removeClass("current"),s.find(".cms_tpv_container").jstree("destroy").html(""),s.find("div.cms_tpv_page_actions").removeClass("cms_tpv_page_actions_visible"),cms_tpv_bind_clean_node(),"all"==e?s.find(".cms_tvp_view_all").addClass("current"):"public"==e?s.find(".cms_tvp_view_public").addClass("current"):"trash"==e&&s.find(".cms_tvp_view_trash").addClass("current");var a=jQuery.extend(!0,{},treeOptions);a.json_data.ajax.url=ajaxurl+CMS_TPV_AJAXURL+e+"&post_type="+cms_tpv_get_post_type(t)+"&lang="+cms_tpv_get_wpml_selected_lang(t),s.find(".cms_tpv_container").bind("loaded.jstree open_node.jstree",cms_tpv_tree_loaded),s.find(".cms_tpv_container").jstree(a)}var cms_tree_page_view=function(e){var t={};return t.moduleProperty=1,t.elements={},t.selectors={containers:"div.cms_tpv_container",action_div:"div.cms_tpv_page_actions",action_doit:"div.cms_tpv_action_add_doit"},t.init=function(){t.log("init cms tree page view"),t.setup_elements(),t.setup_listeners()},t.setup_elements=function(){for(var s in t.selectors)t.selectors.hasOwnProperty(s)&&(t.elements[s]=e(t.selectors[s]))},t.setup_listeners=function(){e(document).on("keyup","ul.cms_tpv_action_add_doit_pages li:last-child input",function(){var t=e(this),s=t.closest("li");if(""!==e.trim(t.val())){var _=s.clone().hide();_.find("input").val(""),s.after(_),_.slideDown()}}),jQuery(document).on("click","a.cms_tpv_add_cancel",function(t){t.preventDefault();var s=cms_tpv_get_page_actions_div_doit(this);s.slideUp("fast",function(){e("input[name='cms_tpv_add_status'][value='draft']").attr("checked",!0),e("ul.cms_tpv_action_add_doit_pages").find("li:not(:last)").remove()})}),jQuery(document).on("click","a.cms_tpv_action_add_page_after, a.cms_tpv_action_add_page_inside",function(t){t.preventDefault();var s=jQuery(this),_=(cms_tpv_get_post_type(this),cms_tpv_get_wpml_selected_lang(this)),a=cms_tpv_get_page_actions_div(this),i=cms_tpv_get_page_actions_div_doit(this),n=a.data("post_status"),r="";return s.hasClass("cms_tpv_action_add_page_after")?r="after":s.hasClass("cms_tpv_action_add_page_inside")&&(r="inside"),"trash"===n&&"inside"===r?(jAlert(cmstpv_l10n.Can_not_add_page_after_when_status_is_trash),void 0):"draft"===n&&"inside"===r?(jAlert(cmstpv_l10n.Can_not_add_sub_page_when_status_is_draft),!1):(e("ul.cms_tpv_action_add_doit_pages").sortable({axis:"y",items:"> li:not(:last)",containment:"parent",forceHelperSize:!0,forcePlaceholderSize:!0,handle:"span:first",placeholder:"ui-state-highlight"}),i.find("[name='lang']").val(_),i.find("[name='cms_tpv_add_type'][value='"+r+"']").attr("checked","checked"),i.find("[name='ref_post_id']").val(a.data("post_id")),i.slideDown("fast",function(){i.find("[name='cms_tpv_add_new_pages_names[]']").focus()}),void 0)}),jQuery(document).on("submit","div.cms_tpv_action_add_doit form",function(){t.log("submitting form");var s=e(this);s.find("input[type='submit']").val(cmstpv_l10n.Adding).attr("disabled",!0)})},t.log=function(){"object"==typeof window.console&&"function"==typeof window.console.log},t}(jQuery);jQuery(function(){cms_tree_page_view.init()});var cms_tpv_tree,treeOptions,div_actions,cms_tpv_current_li_id=null;jQuery(function(e){cms_tpv_tree=e("div.cms_tpv_container"),div_actions=e("div.cms_tpv_page_actions"),cms_tpv_message=e("div.cms_tpv_message");var t="20",s="18",_="20";css_string=".jstree ul, .jstree li { display:block; margin:0 0 0 0; padding:0 0 0 0; list-style-type:none; } .jstree li { display:block; min-height:"+t+"px; line-height:"+t+"px; white-space:nowrap; margin-left:18px; min-width:18px; } .jstree-rtl li { margin-left:0; margin-right:18px; } .jstree > ul > li { margin-left:0px; } .jstree-rtl > ul > li { margin-right:0px; } .jstree ins { display:inline-block; text-decoration:none; width:18px; height:"+t+"px; margin:0 0 0 0; padding:0; } .jstree a { display:inline-block; line-height:"+s+"px; height:"+s+"px; color:black; white-space:nowrap; text-decoration:none; padding:1px 2px; margin:0; } .jstree a:focus { outline: none; } .jstree a > ins { height:"+_+"px; width:16px; } .jstree a > .jstree-icon { margin-right:3px; } .jstree-rtl a > .jstree-icon { margin-left:3px; margin-right:0; } li.jstree-open > ul { display:block; } li.jstree-closed > ul { display:none; } #vakata-dragged { background-color: white; };",e.vakata.css.add_sheet({str:css_string,title:"jstree_cms_tpv"}),treeOptions={plugins:["themes","json_data","cookies","search","dnd","types"],core:{html_titles:!0},json_data:{ajax:{url:ajaxurl+CMS_TPV_AJAXURL+CMS_TPV_VIEW,data:function(e){if(e.data){var t=e.data("post_id");return{id:t}}},success:function(e){null!==e&&e||(cms_tpv_message.html("<p>"+cmstpv_l10n["No posts found"]+"</p>"),cms_tpv_message.show())},error:function(){}}},themes:{theme:"wordpress",dots:!1},search:{ajax:{url:ajaxurl+CMS_TPV_AJAXURL+CMS_TPV_VIEW},case_insensitive:!0},dnd:{}},cms_tpv_tree.length>0&&cms_tpv_bind_clean_node(),cms_tpv_tree.each(function(t,s){var _=e(s),a=jQuery.extend(!0,{},treeOptions),i=cms_tpv_get_post_type(s);a.json_data.ajax.url=a.json_data.ajax.url+"&post_type="+i+"&lang="+cms_tpv_get_wpml_selected_lang(s),a.json_data.data=cms_tpv_jsondata[i];var n=e(s).closest(".cms_tpv_wrapper").find("[name=cms_tpv_meta_post_type_hierarchical]").val();"0"===n&&(a.types={types:{"default":{valid_children:["none"]}}}),a.search.ajax.url=ajaxurl+CMS_TPV_AJAXURL+CMS_TPV_VIEW+"&post_type="+cms_tpv_get_post_type(this),_.bind("search.jstree",function(t,s){0===s.rslt.nodes.length&&e(this).closest(".cms_tpv_wrapper").find(".cms_tree_view_search_form_no_hits").fadeIn("fast")}),_.bind("loaded.jstree",cms_tpv_tree_loaded),_.jstree(a)})}),jQuery(document).on("mouseleave","div.cms_tpv_container",function(e){cms_tree_page_view.log("mouseleave container");var t=jQuery(e.target).closest("div.cms_tpv_container"),s=t.closest("div.cms_tpv_wrapper"),_=t.data("cmstpv_global_link_timer");_&&(cms_tree_page_view.log("clear global timer"),clearTimeout(_));var a=cms_tpv_get_page_actions_div_doit(this);if(!a.is(":visible")){var i=setTimeout(function(){cms_tree_page_view.log("maybe hide popup because outside container");var _=jQuery(e.relatedTarget);_.hasClass("cms_tpv_page_actions")?cms_tree_page_view.log("cancel hide beacuse over actions div"):(cms_tree_page_view.log("do hide"),t.find("li.has-visible-actions").removeClass("has-visible-actions"),t.find("a.hover").removeClass("hover"),s.find("div.cms_tpv_page_actions").removeClass("cms_tpv_page_actions_visible"))},500);t.data("cmstpv_global_link_timer",i)}}),jQuery(document).on("mouseenter","div.cms_tpv_page_actions",function(){var e=jQuery(this),t=e.closest("div.cms_tpv_wrapper"),s=t.find("div.cms_tpv_container"),_=s.data("cmstpv_global_link_timer");clearTimeout(_)}),jQuery(document).on("mouseenter","div.cms_tpv_container",function(){jQuery(this);jQuery.data(this,"cmstpv_do_hide_after_timeout",!1)}),jQuery(document).on("submit","form.cms_tree_view_search_form",function(){var e=jQuery(this).closest(".cms_tpv_wrapper");e.find(".cms_tpv_search_no_hits").hide();var t=e.find(".cms_tree_view_search").attr("value");return t=jQuery.trim(t),t?(e.find(".cms_tree_view_search_form_no_hits").fadeOut("fast"),e.find(".cms_tree_view_search_form_working").fadeIn("fast"),e.find(".cms_tree_view_search_form_reset"),e.find(".cms_tpv_container").jstree("search",t),e.find(".cms_tree_view_search_form_reset").fadeIn("fast")):(e.find(".cms_tree_view_search_form_no_hits").fadeOut("fast"),e.find(".cms_tpv_container").jstree("clear_search"),e.find(".cms_tree_view_search_form_reset").fadeOut("fast")),e.find(".cms_tree_view_search_form_working").fadeOut("fast"),!1}),jQuery(document).on("click","a.cms_tree_view_search_form_reset",function(){var e=jQuery(this).closest(".cms_tpv_wrapper");return e.find(".cms_tree_view_search").val(""),e.find(".cms_tpv_container").jstree("clear_search"),e.find(".cms_tree_view_search_form_reset").fadeOut("fast"),e.find(".cms_tree_view_search_form_no_hits").fadeOut("fast"),!1}),jQuery(document).on("click","a.cms_tpv_open_all",function(){var e=jQuery(this).closest(".cms_tpv_wrapper");return e.find(".cms_tpv_container").jstree("open_all"),!1}),jQuery(document).on("click","a.cms_tpv_close_all",function(){var e=jQuery(this).closest(".cms_tpv_wrapper");return e.find(".cms_tpv_container").jstree("close_all"),!1}),jQuery(document).on("click","a.cms_tvp_view_all",function(){return cms_tvp_set_view("all",this),!1}),jQuery(document).on("click","a.cms_tvp_view_public",function(){return cms_tvp_set_view("public",this),!1}),jQuery(document).on("click","a.cms_tvp_view_trash",function(){return cms_tvp_set_view("trash",this),!1}),jQuery(document).on("click","a.cms_tvp_switch_lang",function(){$wrapper=cms_tpv_get_wrapper(this),$wrapper.find("ul.cms_tvp_switch_langs a").removeClass("current"),jQuery(this).addClass("current");var e=/cms_tpv_switch_language_code_([\w-]+)/,t=e.exec(jQuery(this).attr("class")),s=t[1];$wrapper.find("[name=cms_tpv_meta_wpml_language]").val(s);var _=$wrapper.find(".cms-tpv-subsubsub-select-view");_.find("li.cms_tvp_view_is_status_view a").each(function(e,t){var _=jQuery(t),a=_.data("post-count-"+s);"undefined"==typeof a&&(a=0),_.find(".count").text("("+a+")")});var a=cms_tpv_get_current_view(this);return cms_tvp_set_view(a,this),!1}),jQuery(function(e){var t=e("#view-switch-tree"),s=t.closest("a"),_=e("div.cmstpv-postsoverview-wrap"),a=e("div.view-switch");if(!a.length){a=e("<div class='view-switch'></div>"),e("div.tablenav-pages:first").after(a);var i=e("#view-switch-list"),n=i.closest("a");a.append(n),a.append(" ")}if(a.append(s),a.addClass("view-switch-cstpv-icon-added"),_.length){$wp_body=e("#wpbody"),$wp_body.addClass("cmstpv_postsoverview_enabled");var r=e("div.view-switch");r.appendTo(_)}});